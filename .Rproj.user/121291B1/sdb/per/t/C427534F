{
    "contents" : "#probit\nlibrary(mblm)\nlibrary(Kendall)\nlist_substs <- function(graph_data, min_reversals){\n    uniq <- unique(graph_data$site_node)\n    uniq <- as.character(uniq)\n    list <- lapply(uniq, function(e) {\n            if (length(graph_data$site_node[graph_data$site_node == e]) >= min_reversals) {\n                return (e)\n            }\n            else {\n                return (NA);\n            }\n            })\n    list <- list[!is.na(list)]\n    list <-as.character(list)\n}\n\n\nkendall_stats <-function (graph_data, substs_list){\n    coeffs <- lapply(substs_list, function(e) {\n              node_data <- graph_data[graph_data$site_node == e,]\n              x <- node_data$radius\n              y <- node_data$density\n              ts <- mblm(y~x)\n              ts[[\"coefficients\"]][\"x\"]}\n              )\n    ts_coeffs <- sapply(coeffs, function(e) e)\n    mk <- lapply (substs_list, function(e) {node_data <- graph_data[graph_data$site_node == e,]\n          MannKendall(node_data$density)}\n          )\n    mk_pvalue <- sapply(mk, function(e) e[2]$sl[1])\n    mk_tau <-sapply(mk, function(e) e[1]$tau[1])\n    results <-data.frame(substs_list, ts_coeffs, mk_tau, mk_pvalue)\n}\n\nplot_substs <- function(substs_list, graph_data, prefix){\n  lapply(substs_list, function(e){\n    data  <- graph_data[graph_data$site_node == e,]\n    file <-paste(prefix, e, \".png\", sep=\"\")\n    print (file)\n    png(filename = file)\n    print(data$radius)\n    plot(data$radius, data$density, type=\"l\")\n    dev.off()\n  })\n}\n\n#graph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_diff_rings_h3.csv\")\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n2.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\n\nlist <- list_substs(graph_data, 3)\nresults <- kendall_stats(graph_data, list)\nbest_sites <- results[results$mk_pvalue < 0.05,]\n\nhist(results$ts_coeffs, seq(from = min(results$ts_coeffs), to = max(results$ts_coeffs)+0.0001, by = 0.00005))\nhist(results$mk_tau, seq(from = min(results$mk_tau), to = max(results$mk_tau)+0.0001, by = 0.00005))\n\nhist(best_sites$ts_coeffs, seq(from = min(best_sites$ts_coeffs), to = max(best_sites$ts_coeffs)+0.0001, by = 0.00005))\nhist(best_sites$mk_tau, seq(from = min(best_sites$mk_tau), to = max(best_sites$mk_tau)+0.0001, by = 0.00005))\n\nplots <-plot_substs(as.character(best_sites$substs_list), graph_data, \"n2_diff_rings_plot_\")\n\n#####\nh1_longliving <- c(\"4_INTNODE2429\",\"60_INTNODE2435\",\"73_INTNODE2425\",\"78_INTNODE2434\",\"85_INTNODE2434\",\"90_INTNODE2429\",\"111_INTNODE2428\",\"113_INTNODE2429\",\"138_INTNODE2416\",\"145_INTNODE2426\",\"151_INTNODE2425\",\"169_INTNODE2434\",\"171_INTNODE2429\",\"176_INTNODE2434\",\"178_INTNODE2426\",\"179_INTNODE2429\",\"184_INTNODE2429\",\"186_INTNODE2429\",\"201_INTNODE2434\",\"206_INTNODE2435\",\"238_INTNODE2422\",\"240_INTNODE2421\",\"261_INTNODE2435\",\"269_INTNODE2423\",\"292_INTNODE2433\",\"293_INTNODE2415\",\"311_INTNODE2423\",\"415_INTNODE2429\",\"470_INTNODE2428\",\"488_INTNODE2434\")\nplots <-plot_substs(as.character(h1_longliving), graph_data, \"h1_longliving_diff_rings_plot_\")\n\nh3_longliving <- c(\"495_INTNODE4258\",\"469_INTNODE4224\",\"315_INTNODE4207\",\"291_INTNODE4258\",\"276_INTNODE4232\",\"258_INTNODE4258\",\"233_INTNODE4230\",\"229_INTNODE4224\",\"206_INTNODE4200\",\"204_INTNODE4256\",\"189_INTNODE4224\",\"179_INTNODE4222\",\"176_INTNODE4231\",\"175_INTNODE4215\",\"173_INTNODE4200\",\"162_INTNODE4232\",\"159_INTNODE4230\",\"142_INTNODE4238\",\"138_INTNODE4257\",\"110_INTNODE4209\",\"98_INTNODE4207\",\"94_INTNODE4262\",\"79_INTNODE4239\",\"70_INTNODE4232\",\"69_INTNODE4232\",\"66_INTNODE4232\",\"47_INTNODE4266\",\"19_INTNODE4238\",\"18_INTNODE4224\",\"16_INTNODE4236\",\"15_INTNODE4236\",\"14_INTNODE4262\")\nplots <-plot_substs(as.character(h3_longliving), graph_data, \"h3_longliving_diff_rings_plot_\")\n\n## plot sites with significant LR for exponential and weibull model\n###\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h3.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh3_best_likelihood<- c(\"19_INTNODE4238\", \"69_INTNODE4232\", \"66_INTNODE4232\", \"110_INTNODE4209\", \"15_INTNODE4236\", \"153_INTNODE4102\", \"153_INTNODE4103\", \"153_INTNODE4232\", \"151_INTNODE4202\")\nplots <-plot_substs(as.character(h3_best_likelihood), graph_data, \"h3_likelihood_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h1.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh1_best_likelihood<- c(\"238_INTNODE2422\", \"205_INTNODE2406\", \"169_INTNODE2434\", \"169_INTNODE2394\", \"73_INTNODE2425\", \"151_INTNODE2425\", \"171_INTNODE2429\", \"202_INTNODE2406\" )\nplots <-plot_substs(as.character(h1_best_likelihood), graph_data, \"h1_likelihood_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n1.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nn1_best_likelihood<- c(\"200_INTNODE2384\", \"382_INTNODE2390\")\nplots <-plot_substs(as.character(n1_best_likelihood), graph_data, \"n1_likelihood_plot_\")\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_n2.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nn2_best_likelihood<- c(\"221_INTNODE4476\", \"248_INTNODE4608\", \"329_INTNODE4636\", \"466_INTNODE4636\")\nplots <-plot_substs(as.character(n2_best_likelihood), graph_data, \"n2_likelihood_plot_\")\n\n\n##\n\ngraph_data <-read.csv(\"C:/Users/weidewind/Documents/CMD/Coevolution/Influenza/perlOutput/Output/egor_h3.csv\")\ngraph_data <-data.frame(\"radius\"=graph_data$radius, \"site_node\"=paste(graph_data$site, graph_data$node, sep=\"_\"), \"density\"=graph_data$density)\nh3_chosen <- c(\"161_INTNODE3854\")\nplots <-plot_substs(as.character(h3_chosen), graph_data, \"h3_chosen_plot_\")\n",
    "created" : 1464707392237.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1525507471",
    "id" : "C427534F",
    "lastKnownWriteTime" : 1465549557,
    "path" : "C:/Users/weidewind/workspace/RCoevolution/R/Kendall_stats.R",
    "project_path" : "R/Kendall_stats.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}